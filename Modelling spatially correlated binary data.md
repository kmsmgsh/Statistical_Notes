# Modelling spatially correlated binary data

Joint work with Youjun Huang of Sichuan University and Gabrielle Kelly of University College of Dublin, Ireland.

---

空间相关的二元数据

binary data  0-1 data，binomial

广义线性模型：数据是相互独立的

实施中，不一定是相互独立的:相关的binary data

用数学的符号说

Y1,....,Ym, 每个数据都是0，1

每个人都有很多基因，2w多个，基因和某种疾病是有关系的，比方说癌症，和某些基因的变化是有关系的。

基因有没有出问题，有问题是1，不然是0，这些基因来自同一个人，所以是相关的，不能简单地把这个相关性给忽略掉。对二元数据来说，只要把相关系数搞定，均值方差矩阵就知道了。均值mu已知，方差就是mu（1-mu）

这个数据，y的话是个向量，和原来我们见到过的二元数据不一样的地方是相关的

比方说是空间相关的，比方说传染病，流行病。因为人与人之间有个距离，这个距离就叫做空间相关

对于连续性的数据来说，可以设定方差矩阵，比如均匀的，AR（1）。。。这些都是连续的

对于离散的，没有这个说法，所以说应该怎么做？

这个问题非常基本，y是离散的，相关的，最极端是0-1

边际分布是可以写出来的，是一个bernoulli分布，联合分布搞不定，相关矩阵写不出来。

除此之外，还有一个非常重要的limit,constrain，如果R是相关矩阵，pearson-相关矩阵。可以证明，每个元素，这个矩阵中任一元素，一定有个上线，这个上限是小于1的，

odss (mui/(1-mui))^{1/2}

odds ratio: 哪个小就是上界
$$
r_{ij}\leqslant min\{\}
$$
得把上界考虑进去，如果不考虑进去，这个方法是有问题的。

Diggle and Ribeiro，Generalized linear geostatistical models(GLGM's) for spatial binary data.

Let S(s) be a stationary Gaussian Process with mean 0, S是地理位置，location，是一个高斯过程，方差矩阵是有一个$\Sigma = \sigma^2_S \rho (s_i-s_j)$像是广义线性混合模型。
$$
g(\mu_i)=X(s_i)^T\beta+S(s_i)
$$
mu_i 是条件均值，给定random effect 以后的均值

成功的概率是怎么依赖于那一点上的高斯过程，随机效应。

房差就是概率乘上一减概率

考虑marginal

按照具体的数学式子来，求他的marginal expectation，用双重数学期望就能写出来

方差能写成一个解析式子
$$
var(Y(s))=......=V_{\mu(s)}\Sigma_S V_{\mu(s)}
$$
但是这里面，没考虑对相关系数的上界的要求。

这套系统下，怎么做相关系数的估计。现在为止，不知道怎么做。

方法是很一般的，对Y的形式没有特殊的要求。

那特殊情况中，Y是binary的，有上界，怎么修改这个问题。

Y是二值的随机向量，每个元是二值的也是相关的。



Lin&Clayton 2005提出来一个非常类似于GEE的方法，他这样：y是我的随机向量，我的观察向量：每个mu都是均值都考虑的是marginal。

然后中间这块是残差：Y的方差矩阵的逆，inverse

P是一个微分矩阵，mu关于beta的微分，出来的话是个矩阵。放转置在这，这向量的维数

伪似然方法。quasi-likelihood

把伪似然微分以后就是score function，假的：quasi-score function因为没有似然，只有quasi似然

解方程然后得到beta的估计：这就是GEE

但是现在我们不光关心均值，还关心相关系数，怎么对相关系数做模型

比方说某种传染病，流行病。判断感染程度，和physical distance有关：相关系数可以依赖于自变量相关系数随着个体的变化发生什么样的变化。以上方程没办法做到这个事情，只能说和covariate相关。

covariance matrix $\Sigma$可以用variance-covariance分解进行分解。

$\Sigma=\Sigma_1^{1/2} \Sigma_2 \Sigma_1^{1/2}$ 

$\Sigma_{ij}=(\sigma_i\sigma_jr_{ij})$ 方差不是问题，相关系数不知道怎么估计

$\sigma_i=(1-\mu_i)\mu_i$

可以用LIang&zeager的GEE方法。

用一个简单的代替：identity matrix，等相关的，或者是AR（1），

或者一个知道的working matrix代替他。如果弄错了，但是如果关心的只是均值影响不大，但是对标准差是回产生影响的。

如果不假定工作矩阵，怎么直接对其进行建模？

Lin&Clayton(2005) 假定$Y\sim \text{isotropic process}$,如果是时间序列的话就是stationary。

一边是离散的Y_i和Y_j这两个随机变量之间的相关系数，叫$r_{ij}$ 在金融上应用最广的叫copula：离散和连续的搭个桥。

Oman&Zucker (2001) 他们发现，对于离散的随机变量来说他的相关系数能写成
$$
r_{ij}=\overline r_{ij}c_ij(\gamma)
$$
通过一个常数c，$\overline r_{ij}$ 是上界

c_i是正态分布随机变量的相关系数：就把离散的，和连续的，正态的联系起来了。

但是在其文章中只证明了对三个管用：AR(1),MA(1)，和exchangeable三种结构证明这是对的。

猜想：对任何结构的都对。

空间结构中，最常用的是指数结构: $c_{ij}(\gamma)=exp(-d(s_i,s_j)/\gamma)$ $\gamma$是decreasing rate。

在空间结构中，最常用的就是这个结构，需要证明他对不对。（结果是对的。）

正态模型的相关系数，很自然的这是小于1的，所以两个相乘的话是小于1的。所以是1的

左边是离散数据的相关系数，右边是连续数据的相关系数。

在biometrika里面证明了，对ar(1), ma(1)。。。是对的。猜想对所有结构都对，但是他没给出证明。

首先证明了这个是对的，包括指数结构，还有任意其他的。

证明思路是

Y_i =1 ,引进一个潜变量Z=(z_1,....,z_n)^T潜在的多元正态分布的随机向量。Y是离散的，Z是连续的。

Omega可以依赖一个新的相关系数。$\phi(\mu_i)$ 标准正态分布的d函数做一个变换。就很想critical value。就用这个Zi,是多元正态分布中产生一个Z，产生一个连续的随机向量。把里面的每一个元素做比较，如果小于，就是0，不然就是1. 这就和连续的就联系起来了。Zucker的文章中，$Pr(Y_i \times Y_j=1)$ 也就是都是1，一定能写成
$$
Pr(Y_i\times Y_j=1)=(1-c_{ij}\mu_i\mu_j) + c_{ij}min\{\mu_i,\mu_j\}
$$
如果c不是0，用边际的东西，去刻画joint的。

在其文章中证明了，只要他的概率k写成这个样子，我的二值随机变量的系数，一定能写成（3）式子下面那个式子的式子的形式。
$$
r_{ij}=...=c_{ij}\overline r_{ij}
$$
问题是这个式子什么时候成立。

按照定义，zi是多元正态，就是一个双重积分phi_2从$-\infty$ 到$\mu_i$。。。这个是二元的标准正态分布函数。二维正态分布函数，均值是0，方差是1，两个的方差都是1，但是有个相关系数，$\rho_{ij}$ mu_i,mu_j是边际的，所以是个一维的积分。

这个式子是这样说的，比方说，我给定权重c，给定均值，只要c和mu一旦给定，上面这个phi_2的式子，就可以把rho找出来。由$\nu $ 的定义，然后右边就知，而rho又是潜变量多元正太的相关系数。就能解出rho

这就提出来一个如何产生相关的二值相关的随机变量的方法。只要知道rho，二维的正态分布中就能产生多元的随机向量。也就是z有了就能构造y，虽然这是二值的随机变量，但是有个潜在的连续的二元正态分布和其对应。也就是对的。最极端的，概率是1/2，$\nu=0$, 就能写出来，rho和权重c有什么关系？现在的问题就等于说，我的二值系数的相关系数，是怎么依赖于数据之间的距离，c怎么依赖于距离的，也就是说rho是怎么依赖于两点之间的距离的。

是一个多元正太的相关系数。r是一个离散的二值的系数

这就是copula的思想。

后来的问题就是，怎么去model c。

每个元素就是$c_{ij}$ 比如依赖于新的参数gamma，那怎么估gamma，我回来过来看数据。我有0-1的数据，构造一个$W_{ij}=(Y_i-Y_j)^2$ $W_{ij}$ 也是0-1的，数学期望是能写出来的。和均值是有关系的这点上的数学期望，这两点的数学期望，这一块叫做f，另外这块叫做h，f和h都是$\mu_i$和$\mu_j$的函数。是均值mu里面的参数。

我的mu是和我的beta有关系的。我的mu知道了，betamu_i,mu_j就都有了，不知道的是c里面的gamma。

可以证明，c服从一个相关的bernoulli分布。所以方差能写出来。

但是注意W是相关的，不能简单地使用广义线性模型。

假定我知道了beta，怎么把gamma，相关系数c里面的参数，估计出来。

构造第二套GEE，对相关系数里面的东西进行构造方程。

W_{ij} 的维数构造GEE

把下三角的全部拉直得到一个新的W,$n(n-1)/2\times 1$维的。

Q是什么，是对均值关于gamma求导。

第一套估计方程是估计beta的，第二套是估计gamma的。

问题来了，G不知道，非常高维。

用GEE他的思想，构造一个sandwich-decomposition covariance
$$
G=G_1^{1/2}G_2G_1^{1/2}
$$
方差不是问题，问题是G_2，W元素之间的相关系数构成的矩阵。

W是高维，怎么办

$G_2(\alpha)$ 是不知道的。

假设是均匀的，或者AR（1）用知道的代替不知道的。

依赖于一个新的相关系数$\alpha$ G是什么，W的方差。W是什么，(Y_2-Y_1)^2，数据平方的方差是什么？是四阶矩。Zucker那篇文章，如果设错了高阶矩，对低阶的不构成太大的影响，也就是四阶矩就算设错了，1，2阶矩中的参数估计不会有太大的影响。所以G2的结构怎么设都可以，理论上差异不会太大。

G_2的矩阵的维数：$N\times N$ 这个inverse的计算也不是一个容易的事情。

那怎么办：我们说G_2怎么选不重要，那选AR（1）或者均匀的，那逆矩阵是有解析表达式的。求逆的计算量就不是问题了。

后面就谈算法了

给均值的参数一个均值（比如广义线性模型。）

给alpha一个固定的值，W的相关系数矩阵的参数alpha，计算W，(Y_i -Y_j)^2 然后就有了均值函数

第二个方程就能解了，c就是w的均值。

现在知道了F和H，gamma是c的参数

然后就可以用第二套方程把gamma解出来。

用beta初值找到了gamma初值，然后形成矩阵c，然后就能构造y的方差矩阵，因为其关系已经给定了。就相当于有了c，有了上界，就有了r，二元数据的相关系数矩阵。方差也有了，就能构造出y的方差矩阵。然后就能回到第一个GEE，不知道的是beta，然后就能把beta给出来，两套GEE

然后用第一套方程能得到beta新的估计，然后就能重复以上过程直到

对于相关系数里面的参数，就得构造一个样本系数矩阵，W就相当于构造出来的数据，然后用这个数据估计参数。

很自然的问题：迭代这两个方程，

假定这两个方程是独立的

渐进理论：这么做对不对。

第一，假定beta是给定的

gamma的估计是一个相合的，收敛速度是$N^{1/2}$

一个n一个N，这么估计出来的beta是渐进正态的

关于beta的

接下来是关于gamma的

给定beta，假定gamma是$N^{1/2}$相合的。同样证明gamma的估计的真值，收敛速度是根号N，这也是一个渐进正太的，均值是0，所以gamma hat是渐进到gamma的，是写的出来的。

这个条件是什么意思：$\xi$是w的均值，

这表示说beta和gamma是相互正交的

下面谈一点初值：beta可以用GLM来做，目的是根号N相合：但是只能初始的时候用

还有一个问题，不但关心参数的估计值，还得关系参数的标准差：标准差怎么估计呢？估计量的方差矩阵：这两个定理给出来了：beta hat的方差矩阵，p的话就是均值对参数beta的求导。所以那一坨东西是能估计出来的。

但是问题是涉及到了W的协方差：算起来很困难，可以用bootstrap方法做。这个条件什么意思：这个条件时说fisher information matrix两套GEE可以理解成为似然函数的导数：fisher信息阵：再求一阶然后期望。

块对角：beta和gamma：可以说是渐进正交的。所以分开来做估计是make sense的，合理的。

从理论上来说这么做是对的。

这个条件什么时候满足：证明：working matrix，$G_2$ 如果是取刚才说的均匀的方差结构以及AR（1）结构，证明了这个（条件）是对的。

也急速W不能太稠密，W的均值对gamma的求导，本身数量级不能太大。

---

接下来是simulation

产生相关的二元数据是非常复杂的事情













Z'e'a'k